
<!DOCTYPE html>
<html>
<head>
	
	<title>Below High Water - Dorset Dives</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="css/leaflet.css" />
    	<link rel="stylesheet" href="css/screen.css" />
	<link rel="stylesheet" href="css/MarkerCluster.css" />
	<link rel="stylesheet" href="css/MarkerCluster.Default.css" />
	<link rel="stylesheet" href="css/tabs.css" />
	<link rel="stylesheet" href="css/leaflet-search.min.css" />
	<link rel="stylesheet" href="css/leaflet-search.src.css" />
	<link rel="stylesheet" href="css/leaflet-search.mobile.src.css" />
	<link rel="stylesheet" href="css/leaflet-search.mobile.min.css" />
	<link rel="shortcut icon" type="image/x-icon" href="markers/SNORKEL.png" />
	<script src="js/leaflet.js"></script>
	<script src="js/leaflet.markercluster.js"></script>
	<script src="js/leaflet.markercluster-src.js"></script>
	<script src="js/leaflet-search.min.js"></script>
	<script src="js/leaflet-search.src.js"></script>
	<script type="text/javascript" src="data/dorsetdives.geojson"></script>
 
</head>
<style>A {text-decoration: none;} </style>
<body>

<div id='map'></div>
<div id="box" style="z-index:5;"></div>
<script>

//Base Maps from Open Street Map
	var map = L.map('map')

	Land = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		maxZoom: 15,
		minZoom: 9,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			     'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
	}).addTo(map);

//Google Satellite maps

	Satellite = L.tileLayer('http://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}', {
		attribution: '&copy; <a href="https://about.google/brand-resource-center/products-and-services/geo-guidelines/#required-attribution">Google </a> contributors'
	}),

//DORIS seabed map for Dorset
	DORIS = L.tileLayer('https://doris.s3.amazonaws.com/newallbathy/{z}/{x}/{y}.png', {
		maxZoom: 15,
		minZoom: 9,
		attribution: '&copy; <a href="https://www.dorsetwildlifetrust.org.uk/doris">Dorset Wildlife Trust</a>'
			}),

	
//Marker template
	siteflag = L.Icon.extend({
		options: {
    		iconSize:     [34, 56],
		iconAnchor:   [17, 56],
		shadowUrl: 'markers/icon-shadow.png',
    		shadowSize:   [34, 56],
    		shadowAnchor: [7, 41],  
    		popupAnchor:  [0, -58]
		}
	});


//Dive Site Location
		var DiveSites = new L.geoJSON(flags, {
      		pointToLayer: (feature, latlng) => {
			var DepthMarker = feature.properties.MAXDEPTH;
			if (DepthMarker > 50) {DepthMarker = "50";
			} else if (DepthMarker > 40) {DepthMarker = "40";
			} else if (DepthMarker > 30) {DepthMarker = "30";
			} else if (DepthMarker > 18) {DepthMarker = "18";
			} else if (DepthMarker > 0) {DepthMarker = "0";	
			};
			var SiteMark = new siteflag({iconUrl:'markers/' + DepthMarker + '/' + feature.properties.TYPE + '.png'});
			return L.marker(latlng, {icon: SiteMark})
			},

		onEachFeature: function (feature, layer) {
		Site = '<a href="#img1" onclick="hideLegEnd()"><h3>'+ feature.properties.NAME + '</h3>'
		title = feature.properties.NAME;
		LatDM = feature.geometry.coordinates[1];
		LatD = Math.floor(Math.abs(LatDM))
		LatM= +((Math.abs(LatDM)-LatD)*60).toFixed(3)
		LatDM = LatD + '&deg' + LatM
		
		LonDM = feature.geometry.coordinates[0];
		LonD = Math.floor(Math.abs(LonDM))
		LonM= +((Math.abs(LonDM)-LonD)*60).toFixed(3)
		LonDM = '00'+ LonD + '&deg' + LonM

		Type = '<img src="markers/' + feature.properties.TYPE + '.png" title="' + feature.properties.TYPE + '" style="width:27px;height:27px; vertical-align:middle;">'
		Shore = '&nbsp<img src="markers/SHORE.png" title="Shore Dive" style="width:27px;height:27px; vertical-align:middle;">'
		Snork = '&nbsp<img src="markers/SNORKEL.png" title="Can be snorkelled" style="width:27px;height:27px; vertical-align:middle;">'
		Protect = '&nbsp<img src="markers/PROTECT.png" title="Protected Site" style="width:27px;height:27px; vertical-align:middle;">'
		Details = '<b> WGS84: </b>	' + LatDM +'&#39N,&nbsp'+ LonDM + '&#39W' +
		          '<b> Depth: </b> ' + feature.properties.MAXDEPTH + 'm' +
			  '<p style="color:black">' + feature.properties.Description + '</p></a>'
		if (feature.properties.SHORE !== 'Y') {Shore = ""}
		if (feature.properties.SNORKEL !== 'Y') {Snork = ""}
		if (feature.properties.PROTECTED !== 'Y') {Protect = ""}
		var content = Site + Details + Type + Protect + Shore + Snork
		layer.bindPopup(content)
		}
    		})

var Clusters = L.markerClusterGroup({maxClusterRadius:50, disableClusteringAtZoom:20, spiderfyOnMaxZoom: true});

Clusters.addLayer(DiveSites).addTo(map);

map.on('popupopen', function(e) {
		MarkName = e.popup._source.feature.properties.NAME
		MarkName = MarkName.split(" ").join("%20");
		document.getElementById("box").innerHTML = '<a href="#" class="lightbox" id="img1" onclick="ShowLegend()"><span style="background-image: url(data/pics/'+MarkName+'.jpg);"></span></a>'
		})


var SW = L.latLng(50.4, -2.5)
var NE = L.latLng(50.7, -1.7)
DorsetBounds = L.latLngBounds(NE,SW);

map.fitBounds([DorsetBounds]);

//map.setView([50.6,-2.1],9.5);

var baseMaps = {
    	"Street": Land,
	"Satellite": Satellite
	};

var overlayMaps = {
	"DORIS": DORIS
	};

L.control.layers(baseMaps, overlayMaps).addTo(map);

depthlegend = L.control({position: 'topright'});
	depthlegend.onAdd = function (map) {
	var div = L.DomUtil.create('div', 'legend');
	div.innerHTML +=  '<div style="background-color:white; padding:5px; border-radius: 7%">' +
	'<strong><center> Dive Depths </strong></center>' +
	'<div class = "row">' +
	'<div class = "column">'+
	'<img class="imageDepth" src="markers/10-marker.png"> 0-18m<br>' +
	'<img class="imageDepth" src="markers/20-marker.png"> 18-30m<br>' +
	'<img class="imageDepth" src="markers/30-marker.png"> 30-40m<br>' +
	'<img class="imageDepth" src="markers/40-marker.png"> 40-50m<br>' +
	'<img class="imageDepth" src="markers/50-marker.png"> 50m +</div>'
	return div;
	};

	depthlegend.addTo(map);

	var iconlegend = L.control({position: 'topleft'});
	iconlegend.onAdd = function (map) {
	var div = L.DomUtil.create('div', 'legend');
	div.innerHTML +=  '<div style="background-color:white; padding:5px; border-radius: 7%">' +
	'<style> img {width:25px; height: 25px; padding: 2px; vertical-align:middle; horizontal-align:middle; } </style>'+
	'<a href="#keybox" onclick=LegendBox()><center> Click for Legend </center>'
	
	return div;
	};

	function LegendBox() {
	hideLegEnd();
	document.getElementById("box").innerHTML = 
	'<a href="#" class="lightbox" id="keybox" onclick="ShowLegend()">' +
	'<table style="width: 50%; margin-left:auto; margin-right:auto;">' +
	'<tr height="10%"><td colspan="4" style="text-align: center;"><p4> Dive Types </p4></td></tr>' +
	'<tr height="10%"><td><img class="imageType" src="markers/Wreck.png"></td><td><p3>Wreck</td><td><img class="imageType" src="markers/SHORE.png"></td><td><p3>Shore Dive<td></tr>' +
	'<tr height="10%"><td><img class="imageType" src="markers/Reef.png"></td><td><p3>Reef</td><td><img class="imageType" src="markers/SNORKEL.png"></td><td><p3>Skin Dive<td></tr>' +
	'<tr height="10%"><td><img class="imageType" src="markers/Drift.png"></td><td><p3>Drift</td><td><img class="imageType" src="markers/PROTECT.png"></td><td><p3>Protected Site<td></tr>' +
	'<tr height="10%"><td><img class="imageType" src="markers/Structure.png"></td><td><p3>Structure<td></tr>'
	
	}
//
	iconlegend.addTo(map);

	function hideLegEnd() {
  		map.removeControl(iconlegend);
		map.removeControl(depthlegend)
		}
	function ShowLegend() {
		iconlegend.addTo(map);
		depthlegend.addTo(map);
		}

	var searchControl = new L.Control.Search({
		layer: Clusters,
		propertyName: 'NAME',
		//marker: false,
		moveToLocation: function(latlng, title, map) {
			map.setView(latlng, 15); // access the zoom
		}
	});
		

	map.addControl(searchControl);

	window.addEventListener("orientationchange", function() {
  	location.reload()
	console.log("Switched")
	}, false);


//function onLocationFound(e) {
	//	var radius = e.accuracy / 2;

	//	L.marker(e.latlng).addTo(map)
	//		.bindPopup("You are within " + radius + " meters from this point").openPopup();

	//	L.circle(e.latlng, radius).addTo(map);
	//}

	//function onLocationError(e) {
	//	alert(e.message);
	//}

	//map.on('locationfound', onLocationFound);
	//map.on('locationerror', onLocationError);

	//map.locate({setView: true, maxZoom: 16});

</script>
</body>
</html>


	